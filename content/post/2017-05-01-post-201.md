---
title: Hyper-Vでレガシーネットワークアダプターを使うときの設定
author: user
type: post
date: 2017-05-01T07:38:59+00:00
url: /tech/201/
featured_image: https://s3-ap-northeast-1.amazonaws.com/resource.www.uranari.io/wp-content/uploads/2017/05/01160001/Legacy.png
amazonS3_cache:
  - 'a:4:{s:104:"//s3-ap-northeast-1.amazonaws.com/resource.www.uranari.io/wp-content/uploads/2017/05/01160001/Legacy.png";i:202;s:54:"//www.uranari.io/wp-content/uploads/2017/05/Legacy.png";i:202;s:109:"//s3-ap-northeast-1.amazonaws.com/resource.www.uranari.io/wp-content/uploads/2017/05/01160405/mac_bokashi.png";i:203;s:59:"//www.uranari.io/wp-content/uploads/2017/05/mac_bokashi.png";i:203;}'
update_level:
  - high
categories:
  - tech

---
自分用メモ

&nbsp;

仮想マシン作るたびにこの設定しないといけないので

Hyper-V上で仮想マシンをたてるときにレガシーネットワークアダプターを使わざるをえないことがあるのでそのときのネットワーク回りの設定の注意点

まずハードウェアの追加でレガシーネットワークアダプターを追加

{{< figure src="https://s3-ap-northeast-1.amazonaws.com/resource.www.uranari.io/wp-content/uploads/2017/05/01160001/Legacy.png" class="center" width="640" height="320" >}}

MACアドレスは固定に

{{< figure src="https://s3-ap-northeast-1.amazonaws.com/resource.www.uranari.io/wp-content/uploads/2017/05/01160405/mac_bokashi.png" class="center" width="640" height="320" >}}

仮想マシン側(今回はCentOS)のinterfaceに割り振ったMACアドレスを記載する
  
それ以外は通常通り設定

{{< highlight plaintext "linenos=table" >}}
/etc/sysconfig/network-scripts/ifcfg-eth0

DEVICE=eth0
HWADDR=XX:XX:XX:XX:XX:XX
TYPE=Ethernet
UUID=hogehoge
ONBOOT=yes
NM_CONTROLLED=yes
BOOTPROTO=dhcp
{{< / highlight >}}

これでもうまくネットワークに繋がらないときは/etc/udev/rules.d/70-persistent-net.rulesでMACアドレスとinterfaceの紐付けが正しいかや同じ名前のinterfaceが複数設定されてないか確認

{{< highlight plaintext "linenos=table" >}}
/etc/udev/rules.d/70-persistent-net.rules

This file was automatically generated by the /lib/udev/write_net_rules
# program, run by the persistent-net-generator.rules rules file.
#
# You can modify it, as long as you keep each rule on a single
# line, and change only the value of the NAME= key.

# PCI device 0x1011:0x0009 (tulip)
SUBSYSTEM=="net", ACTION=="add", DRIVERS=="?*", ATTR{address}=="XX:XX:XX:XX:XX:XX", ATTR{type}=="1", KERNEL=="eth*", NAME="eth0"

# PCI device 0x1011:0x0009 (tulip)
SUBSYSTEM=="net", ACTION=="add", DRIVERS=="?*", ATTR{address}=="XX:XX:XX:XX:XX:XX", ATTR{type}=="1", KERNEL=="eth*", NAME="eth1"
{{< / highlight >}}

今のところこれ以外は特にはまってない